<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Page with Counter</title>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>

    <style>
        body {
            background-color: #1e1e1e;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #eaeaea;
            padding: 20px;
            margin: 0;
        }
        /* Add any additional styles you might need here. */
    </style>
</head>
<body>
    <div style="text-align: center; margin-top: 20px;">
        You are visitor number: <span id="counter">Loading...</span>
    </div>

    <!-- Ad space -->
    <div style="text-align: center; margin-top: 20px;">
        <img id="adSpace" src="default-ad.jpg" alt="Advertisement" style="max-width: 500px;">
    </div>

    <!-- Stripe integration and image upload comes here -->
    <div style="text-align: center; margin-top: 20px;">
        <button id="buyButton">Buy for $<span id="adPrice">1</span></button>
        <input type="file" id="imageUpload" style="display:none;">
    </div>

    <script>
        const firebaseConfig = {
            /* Your Firebase Configuration */
        };

        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.error("Firebase initialization failed:", error);
        }

        const db = firebase.firestore();
        const pageviewsDoc = db.collection('metadata').doc('pageviews');

        pageviewsDoc.get().then(doc => {
            if (doc.exists) {
                let currentCount = doc.data().count;
                document.getElementById('counter').textContent = currentCount;
                pageviewsDoc.update({ count: currentCount + 1 });
            } else {
                console.error("No pageviews data found!");
            }
        }).catch(error => {
            console.error("Error getting pageviews:", error);
        });

        const stripe = Stripe('YOUR_STRIPE_PUBLIC_KEY');  // Replace with your Stripe Public Key
        let currentPrice = 1;  // Start with $1

        document.getElementById('buyButton').addEventListener('click', () => {
            // This is just a basic setup; you'll want to get a session ID from your server.
            stripe.redirectToCheckout({
                sessionId: 'sample_session_id'
            }).then((result) => {
                console.error(result.error.message);
            });
        });

        function updateAd() {
            currentPrice += 1;
            document.getElementById('adPrice').textContent = currentPrice;
            const file = document.getElementById('imageUpload').files[0];
            // Add logic to upload the image to Firebase storage and update the adSpace src.
            // Also, consider updating Firestore with the new price.
        }
    </script>
</body>
</html>
